<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>knncolle_hnsw: knncolle bindings for HNSW</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">knncolle_hnsw
   </div>
   <div id="projectbrief">knncolle bindings for HNSW</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">knncolle bindings for HNSW </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/knncolle/knncolle_hnsw/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/knncolle/knncolle_hnsw/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/knncolle/knncolle_hnsw"><img src="https://codecov.io/gh/knncolle/knncolle_hnsw/branch/master/graph/badge.svg" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>The <b><a class="el" href="namespaceknncolle__hnsw.html" title="knncolle bindings for HNSW search.">knncolle_hnsw</a></b> library provides <a href="https://github.com/knncolle/knncolle"><b>knncolle</b></a> bindings to the <a href="https://github.com/nmslib/hnswlib">HNSW</a> library for approximate nearest neighbors search. This allows users to use HNSW searches in any framework that accepts <b>knncolle</b> interfaces, sacrificing neighbor search accuracy for greater speed. For most applications involving large datasets, this is an acceptable trade-off.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>Instances of the various <code>knncolle_hnsw::Hnsw*</code> classes can be used anywhere that accepts the corresponding <b>knncolle</b> interface. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="knncolle__hnsw_8hpp.html">knncolle_hnsw/knncolle_hnsw.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> ndim = 10;</div>
<div class="line"><span class="keywordtype">int</span> nobs = 10000;</div>
<div class="line">std::vector&lt;double&gt; matrix(ndim * nobs); <span class="comment">// column-major ndim * nobs matrix.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrap our data in a light SimpleMatrix.</span></div>
<div class="line"><a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix&lt;int, double&gt;</a> mat(ndim, nobs, matrix.data());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Build a HNSW index, defaulting to Euclidean distances.</span></div>
<div class="line"><span class="keyword">auto</span> euclid_config = <a class="code hl_function" href="namespaceknncolle__hnsw.html#a939b7a0484ad0abb8ad2771e22b2f763">knncolle_hnsw::configure_euclidean_distance&lt;double&gt;</a>();</div>
<div class="line"><a class="code hl_class" href="classknncolle__hnsw_1_1HnswBuilder.html">knncolle_hnsw::HnswBuilder&lt;int, double, double&gt;</a> h_builder(euclid_config);</div>
<div class="line"><span class="keyword">auto</span> h_index = h_builder.build_unique(mat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Find 10 (approximate) nearest neighbors of every element.</span></div>
<div class="line"><span class="keyword">auto</span> results = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a2c6d8b116464bab254bda34216338c3c">knncolle::find_nearest_neighbors</a>(*h_index, 10); </div>
<div class="ttc" id="aclassknncolle_1_1SimpleMatrix_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix</a></div></div>
<div class="ttc" id="aclassknncolle__hnsw_1_1HnswBuilder_html"><div class="ttname"><a href="classknncolle__hnsw_1_1HnswBuilder.html">knncolle_hnsw::HnswBuilder</a></div><div class="ttdoc">Perform an approximate nearest neighbor search with HNSW.</div><div class="ttdef"><b>Definition</b> Hnsw.hpp:389</div></div>
<div class="ttc" id="aknncolle__hnsw_8hpp_html"><div class="ttname"><a href="knncolle__hnsw_8hpp.html">knncolle_hnsw.hpp</a></div><div class="ttdoc">Approximate nearest neighbor search with HNSW.</div></div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_a939b7a0484ad0abb8ad2771e22b2f763"><div class="ttname"><a href="namespaceknncolle__hnsw.html#a939b7a0484ad0abb8ad2771e22b2f763">knncolle_hnsw::configure_euclidean_distance</a></div><div class="ttdeci">DistanceConfig&lt; Distance_, HnswData_ &gt; configure_euclidean_distance()</div><div class="ttdef"><b>Definition</b> distances.hpp:155</div></div>
<div class="ttc" id="anamespaceknncolle_html_a2c6d8b116464bab254bda34216338c3c"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a2c6d8b116464bab254bda34216338c3c">knncolle::find_nearest_neighbors</a></div><div class="ttdeci">NeighborList&lt; Index_, Distance_ &gt; find_nearest_neighbors(const Prebuilt&lt; Index_, Data_, Distance_ &gt; &amp;index, int k, int num_threads=1)</div></div>
</div><!-- fragment --><p>Check out the <a href="https://knncolle.github.io/knncolle_hnsw/">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Customizing the search</h1>
<p>We can also customize the construction of the <code>HnswBuilder</code> by passing in options or specifying a different distance metric:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structknncolle__hnsw_1_1HnswOptions.html">knncolle_hnsw::HnswOptions</a> h_opts;</div>
<div class="line">h_opts.<a class="code hl_variable" href="structknncolle__hnsw_1_1HnswOptions.html#a53d97ffff91e897c5612aefe23b17d97">num_links</a> = 100;</div>
<div class="line"><a class="code hl_class" href="classknncolle__hnsw_1_1HnswBuilder.html">knncolle_hnsw::HnswBuilder&lt;int, double, double&gt;</a> h_builder2(</div>
<div class="line">    <a class="code hl_function" href="namespaceknncolle__hnsw.html#ac959f593dc491c48398c92d0aa56e579">knncolle_hnsw::configure_manhattan_distance&lt;double&gt;</a>(),</div>
<div class="line">    h_opts</div>
<div class="line">);</div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_ac959f593dc491c48398c92d0aa56e579"><div class="ttname"><a href="namespaceknncolle__hnsw.html#ac959f593dc491c48398c92d0aa56e579">knncolle_hnsw::configure_manhattan_distance</a></div><div class="ttdeci">DistanceConfig&lt; Distance_, HnswData_ &gt; configure_manhattan_distance()</div><div class="ttdef"><b>Definition</b> distances.hpp:174</div></div>
<div class="ttc" id="astructknncolle__hnsw_1_1HnswOptions_html"><div class="ttname"><a href="structknncolle__hnsw_1_1HnswOptions.html">knncolle_hnsw::HnswOptions</a></div><div class="ttdoc">Options for HnswBuilder and HnswPrebuilt.</div><div class="ttdef"><b>Definition</b> Hnsw.hpp:40</div></div>
<div class="ttc" id="astructknncolle__hnsw_1_1HnswOptions_html_a53d97ffff91e897c5612aefe23b17d97"><div class="ttname"><a href="structknncolle__hnsw_1_1HnswOptions.html#a53d97ffff91e897c5612aefe23b17d97">knncolle_hnsw::HnswOptions::num_links</a></div><div class="ttdeci">int num_links</div><div class="ttdef"><b>Definition</b> Hnsw.hpp:46</div></div>
</div><!-- fragment --><p>We could also modify the builder after construction, which will affect all subsequently constructed indices:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>&amp; more_opt = h_builder.get_options()</div>
<div class="line">more_opt.ef_construction = 250;</div>
</div><!-- fragment --><p>Advanced users can configure the template parameters to use more suitable types for their applications. A hypothetical configuration is shown below with (mostly made up) reasons:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <a class="code hl_class" href="classknncolle__hnsw_1_1HnswBuilder.html">knncolle_hnsw::HnswBuilder</a>&lt;</div>
<div class="line">    <span class="comment">// The type for the observation indices - perhaps int isn&#39;t big enough to</span></div>
<div class="line">    <span class="comment">// hold all the indices for a large dataset, so we&#39;ll use size_t.</span></div>
<div class="line">    size_t,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The type for the input data, maybe we&#39;re dealing with small counts.</span></div>
<div class="line">    uint8_t,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The type for the distances, maybe we&#39;ll use floats to save space.</span></div>
<div class="line">    float,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The type of matrix that the HnswBuilder takes as input: forcing it</span></div>
<div class="line">    <span class="comment">// to be a SimpleMatrix to enable devirtualization.</span></div>
<div class="line">    <a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix&lt;size_t, uint8_t&gt;</a>,</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The type of data in the HNSW index, using floats for performance.</span></div>
<div class="line">    <span class="keywordtype">float</span></div>
<div class="line">&gt; MyHnswBuilder;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Saving and reloading indices</h1>
<p>To save and reload HNSW indices from disk, we need to register a loading function into <b>knncolle</b>'s <code>load_prebuilt_registry()</code>. This is a little complicated as we must decide on which HNSW types we want to deal with. Here, we only consider the default type, though more could also be supported at the cost of larger binaries and longer compile times.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>&amp; reg = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#aa08de1eb1a23d5e13dc11e23ad7967ea">knncolle::load_prebuilt_registry&lt;int, double, double&gt;</a>();</div>
<div class="line">reg[knncolle_hnsw::hnsw_prebuilt_save_name] = [](<span class="keyword">const</span> std::filesystem::path&amp; dir) -&gt; Prebuilt&lt;int, double, double&gt;* {</div>
<div class="line">    <span class="keyword">auto</span> config = <a class="code hl_function" href="namespaceknncolle__hnsw.html#ab387a5c2fdff9fea73a4f25675e4c805">knncolle_hnsw::load_hnsw_prebuilt_types</a>(dir);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check that the HnswData_ type is the same as the default.</span></div>
<div class="line">    <span class="keywordflow">if</span> (config.data != <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a84e640363d9246c58008c93166021f26">knncolle::get_numeric_type&lt;float&gt;</a>()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;unexpected type for the HNSW data&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceknncolle__hnsw.html#a25828b7350e5b3d45b882488b2a3485f">knncolle_hnsw::load_hnsw_prebuilt&lt;int, double, double&gt;</a>(dir);</div>
<div class="line">};</div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_a25828b7350e5b3d45b882488b2a3485f"><div class="ttname"><a href="namespaceknncolle__hnsw.html#a25828b7350e5b3d45b882488b2a3485f">knncolle_hnsw::load_hnsw_prebuilt</a></div><div class="ttdeci">auto load_hnsw_prebuilt(const std::filesystem::path &amp;dir)</div><div class="ttdef"><b>Definition</b> load_hnsw_prebuilt.hpp:73</div></div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_ab387a5c2fdff9fea73a4f25675e4c805"><div class="ttname"><a href="namespaceknncolle__hnsw.html#ab387a5c2fdff9fea73a4f25675e4c805">knncolle_hnsw::load_hnsw_prebuilt_types</a></div><div class="ttdeci">HnswPrebuiltTypes load_hnsw_prebuilt_types(const std::filesystem::path &amp;dir)</div><div class="ttdef"><b>Definition</b> load_hnsw_prebuilt.hpp:39</div></div>
<div class="ttc" id="anamespaceknncolle_html_a84e640363d9246c58008c93166021f26"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a84e640363d9246c58008c93166021f26">knncolle::get_numeric_type</a></div><div class="ttdeci">NumericType get_numeric_type()</div></div>
<div class="ttc" id="anamespaceknncolle_html_aa08de1eb1a23d5e13dc11e23ad7967ea"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#aa08de1eb1a23d5e13dc11e23ad7967ea">knncolle::load_prebuilt_registry</a></div><div class="ttdeci">std::unordered_map&lt; std::string, LoadPrebuiltFunction&lt; Index_, Data_, Distance_ &gt; &gt; &amp; load_prebuilt_registry()</div></div>
</div><!-- fragment --><p>Then we can save and reload the <code>Prebuilt</code> HNSW indices. Note the caveats on <code><a class="elRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1Prebuilt.html#add21dc74e08a6ad495c6e241fa3d5968">knncolle::Prebuilt::save()</a></code> - specifically, the files are not guaranteed to be portable between machines or even different versions of <b><a class="el" href="namespaceknncolle__hnsw.html" title="knncolle bindings for HNSW search.">knncolle_hnsw</a></b>.</p>
<div class="fragment"><div class="line">std::string save_loc = <span class="stringliteral">&quot;hnsw/location/here&quot;</span>;</div>
<div class="line">std::filesystem::create_directory(save_loc);</div>
<div class="line">an_index.save(save_loc);</div>
<div class="line"><span class="keyword">auto</span> reloaded = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a9cb4f999cb4b25dd5bd4595bfb680f10">knncolle::load_prebuilt_unique</a>(save_loc);</div>
<div class="ttc" id="anamespaceknncolle_html_a9cb4f999cb4b25dd5bd4595bfb680f10"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a9cb4f999cb4b25dd5bd4595bfb680f10">knncolle::load_prebuilt_unique</a></div><div class="ttdeci">std::unique_ptr&lt; Prebuilt&lt; Index_, Data_, Distance_ &gt; &gt; load_prebuilt_unique(const std::filesystem::path &amp;dir)</div></div>
</div><!-- fragment --><p>For custom distances, users can define their own saving and loading methods. For example, if we had a custom distance:</p>
<div class="fragment"><div class="line"><span class="comment">// Mock up a custom distance.</span></div>
<div class="line"><span class="keyword">class </span>MyCustomDistance : <span class="keyword">public</span> hnswlib::SpaceInterface&lt;float&gt; {</div>
<div class="line">    <span class="comment">// Assume we implemented all the methods here.</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a function to save information about this custom distance during .save() calls.</span></div>
<div class="line"><a class="code hl_function" href="namespaceknncolle__hnsw.html#a61b2d818fa7c4cf8e1a8075a1d60297e">knncolle_hnsw::custom_save_for_hnsw_distance&lt;float&gt;</a>() = [](<span class="keyword">const</span> std::filesystem::path&amp; dir, <span class="keyword">const</span> hnswlib::SparseInterface&lt;float&gt;* ptr) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>MyCustomDistance*<span class="keyword">&gt;</span>(ptr) == NULL) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;unknown distance&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> path = dir / <span class="stringliteral">&quot;custom_distance&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> std::string msg = <span class="stringliteral">&quot;hi this is a custom distance&quot;</span>;</div>
<div class="line">    <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#acf69c31b24c8a2bda72371f64133f8b8">knncolle::quick_save</a>(path, msg.c_str(), msg.size());</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a function to recreate our custom distance during load_prebuilt_*() calls.</span></div>
<div class="line"><a class="code hl_function" href="namespaceknncolle__hnsw.html#acdb271a47b3cea4e62dd9fcbf5114a51">knncolle_hnsw::custom_load_for_hnsw_distance&lt;float&gt;</a>() = [](<span class="keyword">const</span> std::filesystem::dir&amp; dir, std::size_t ndim) -&gt; hnswlib::SparseInterface&lt;float&gt;* ptr) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> path = dir / <span class="stringliteral">&quot;custom_distance&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> std:<span class="keywordtype">string</span> msg = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a9191267167f1e0d7201b276c8a9caa2a">knncolle::quick_load_as_string</a>(path);</div>
<div class="line">    <span class="keywordflow">if</span> (msg != <span class="stringliteral">&quot;hi this is a custom distance&quot;</span>) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;unknown custom distance&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> MyCustomDistance(ndim);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structknncolle__hnsw_1_1DistanceConfig.html">knncolle_hnsw::DistanceConfig&lt;double&gt;</a> custom_config;</div>
<div class="line">custom_config.<a class="code hl_variable" href="structknncolle__hnsw_1_1DistanceConfig.html#a631f9820cbc2e7fbbeab10a78019d483">create</a> = [](std::size_t n) -&gt; hnswlib::SparseInterface&lt;float&gt;* {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> MyCustomDistance(n);</div>
<div class="line">};</div>
<div class="line"><a class="code hl_class" href="classknncolle__hnsw_1_1HnswBuilder.html">knncolle_hnsw::HnswBuilder&lt;int, double, double&gt;</a> custom_builder(std::move(custom_config));</div>
<div class="line"><span class="keyword">auto</span> custom_index = custom_builder.build_unique(mat);</div>
<div class="line"> </div>
<div class="line">std::filesystem::path custom_dir = <span class="stringliteral">&quot;hnsw/location/custom_&quot;</span>;</div>
<div class="line">std::filesystem::create_directory(custom_dir);</div>
<div class="line">custom_index.save(custom_dir);</div>
<div class="line"><span class="keyword">auto</span> custom_reloaded = <a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a9cb4f999cb4b25dd5bd4595bfb680f10">knncolle::load_prebuilt_unique</a>(custom_dir);</div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_a61b2d818fa7c4cf8e1a8075a1d60297e"><div class="ttname"><a href="namespaceknncolle__hnsw.html#a61b2d818fa7c4cf8e1a8075a1d60297e">knncolle_hnsw::custom_save_for_hnsw_distance</a></div><div class="ttdeci">std::function&lt; void(const std::filesystem::path &amp;, const hnswlib::SpaceInterface&lt; HnswData_ &gt; *)&gt; &amp; custom_save_for_hnsw_distance()</div><div class="ttdef"><b>Definition</b> utils.hpp:63</div></div>
<div class="ttc" id="anamespaceknncolle__hnsw_html_acdb271a47b3cea4e62dd9fcbf5114a51"><div class="ttname"><a href="namespaceknncolle__hnsw.html#acdb271a47b3cea4e62dd9fcbf5114a51">knncolle_hnsw::custom_load_for_hnsw_distance</a></div><div class="ttdeci">std::function&lt; hnswlib::SpaceInterface&lt; HnswData_ &gt; *(const std::filesystem::path &amp;, std::size_t)&gt; &amp; custom_load_for_hnsw_distance()</div><div class="ttdef"><b>Definition</b> utils.hpp:114</div></div>
<div class="ttc" id="anamespaceknncolle_html_a9191267167f1e0d7201b276c8a9caa2a"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#a9191267167f1e0d7201b276c8a9caa2a">knncolle::quick_load_as_string</a></div><div class="ttdeci">std::string quick_load_as_string(const std::filesystem::path &amp;path)</div></div>
<div class="ttc" id="anamespaceknncolle_html_acf69c31b24c8a2bda72371f64133f8b8"><div class="ttname"><a href="https://knncolle.github.io/knncolle/namespaceknncolle.html#acf69c31b24c8a2bda72371f64133f8b8">knncolle::quick_save</a></div><div class="ttdeci">void quick_save(const std::filesystem::path &amp;path, const Input_ *const contents, const Length_ length)</div></div>
<div class="ttc" id="astructknncolle__hnsw_1_1DistanceConfig_html"><div class="ttname"><a href="structknncolle__hnsw_1_1DistanceConfig.html">knncolle_hnsw::DistanceConfig</a></div><div class="ttdoc">Distance configuration for the HNSW index.</div><div class="ttdef"><b>Definition</b> distances.hpp:31</div></div>
<div class="ttc" id="astructknncolle__hnsw_1_1DistanceConfig_html_a631f9820cbc2e7fbbeab10a78019d483"><div class="ttname"><a href="structknncolle__hnsw_1_1DistanceConfig.html#a631f9820cbc2e7fbbeab10a78019d483">knncolle_hnsw::DistanceConfig::create</a></div><div class="ttdeci">std::function&lt; hnswlib::SpaceInterface&lt; HnswData_ &gt; *(std::size_t)&gt; create</div><div class="ttdef"><b>Definition</b> distances.hpp:35</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  knncolle_hnsw</div>
<div class="line">  GIT_REPOSITORY https://github.com/knncolle/knncolle_hnsw</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(knncolle_hnsw)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespaceknncolle__hnsw.html" title="knncolle bindings for HNSW search.">knncolle_hnsw</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe knncolle::knncolle_hnsw)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_hnsw)</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. Applications are advised to pin the versions of each dependency for stability - see <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> for suggested versions. If you want to install them manually, use <code>-DKNNCOLLE_HNSW_FETCH_EXTERN=OFF</code>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(knncolle_knncolle_hnsw CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_hnsw)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DKNNCOLLE_HNSW_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Again, this will automatically acquire all its dependencies, see recommendations above.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This will also require the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Note on vectorization</h1>
<p>HNSW will attempt to perform manual vectorization based on SSE and/or AVX instructions. This may result in differences in the results across machines due to changes in numeric precision across architectures with varying support for SSE/AVX intrinsics. For the most part, such differences can be avoided by consistently compiling for the "near-lowest common denominator" (such as the typical <code>x86-64</code> default for GCC and Clang) and ensuring that the more specific instruction subsets like SSE3 and AVX are not enabled (which are typically off by default anyway). Nonetheless, if reproducibility across architectures is important, it can be achieved at the cost of some speed by defining the <code>NO_MANUAL_VECTORIZATION</code> macro, which will instruct Hnsw to disable its vectorized optimizations. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
