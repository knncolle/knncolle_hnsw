<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>knncolle_hnsw: knncolle bindings for Hnsw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">knncolle_hnsw
   </div>
   <div id="projectbrief">knncolle bindings for HNSW</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">knncolle bindings for Hnsw </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/knncolle/knncolle_hnsw/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/knncolle/knncolle_hnsw/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/knncolle/knncolle_hnsw"><img src="https://codecov.io/gh/knncolle/knncolle_hnsw/branch/master/graph/badge.svg" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>The <b><a class="el" href="namespaceknncolle__hnsw.html" title="knncolle bindings for HNSW search.">knncolle_hnsw</a></b> library provides <a href="https://github.com/knncolle/knncolle"><b>knncolle</b></a> bindings to the <a href="https://github.com/nmslib/hnswlib">HNSW</a> library for approximate nearest neighbors search. This allows users to use HNSW searches in any framework that accepts <b>knncolle</b> interfaces, sacrificing neighbor search accuracy for greater speed. For most applications involving large datasets, this is an acceptable trade-off.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>Instances of the various <code>knncolle_hnsw::Hnsw*</code> classes can be used anywhere that accepts the corresponding <b>knncolle</b> interface. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;knncolle/knncolle_hnsw.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wrap our data in a light SimpleMatrix.</span></div>
<div class="line"><a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix&lt;int, int, double&gt;</a> mat(ndim, nobs, matrix.data());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Build an Hnsw index. </span></div>
<div class="line"><a class="code hl_class" href="classknncolle__hnsw_1_1HnswPrebuilt.html">knncolle_hnsw::HnswBuilder&lt;&gt;</a> an_builder;</div>
<div class="line"><span class="keyword">auto</span> an_index = an_builder.build_unique(mat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Find 10 (approximate) nearest neighbors of every element.</span></div>
<div class="line"><span class="keyword">auto</span> results = knncolle::find_nearest_neighbors(*an_index, 10); </div>
<div class="ttc" id="aclassknncolle_1_1SimpleMatrix_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1SimpleMatrix.html">knncolle::SimpleMatrix</a></div></div>
<div class="ttc" id="aclassknncolle__hnsw_1_1HnswPrebuilt_html"><div class="ttname"><a href="classknncolle__hnsw_1_1HnswPrebuilt.html">knncolle_hnsw::HnswPrebuilt</a></div><div class="ttdoc">Prebuilt index for an Hnsw search.</div><div class="ttdef"><b>Definition</b> knncolle_hnsw.hpp:218</div></div>
</div><!-- fragment --><p>We could alternate between exact and approximate searches at run-time:</p>
<div class="fragment"><div class="line">std::unique_ptr&lt;knncolle::Prebuilt&lt;int, int, double&gt; &gt; ptr;</div>
<div class="line"><span class="keywordflow">if</span> (use_exact) {</div>
<div class="line">    <a class="code hl_classRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1KmknnBuilder.html">knncolle::KmknnBuilder&lt;&gt;</a> kbuilder;</div>
<div class="line">    ptr = kbuilder.<a class="code hl_functionRef" href="https://knncolle.github.io/knncolle/classknncolle_1_1Builder.html#afeda432debae999f988f32f147055251">build_unique</a>(mat);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    knncolle::HnswBuilder&lt;&gt; abuilder;</div>
<div class="line">    ptr = abuilder.build_unique(mat);</div>
<div class="line">}</div>
<div class="ttc" id="aclassknncolle_1_1Builder_html_afeda432debae999f988f32f147055251"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1Builder.html#afeda432debae999f988f32f147055251">knncolle::Builder::build_unique</a></div><div class="ttdeci">std::unique_ptr&lt; Prebuilt&lt; typename Matrix_::dimension_type, typename Matrix_::index_type, Float_ &gt; &gt; build_unique(const Matrix_ &amp;data) const</div></div>
<div class="ttc" id="aclassknncolle_1_1KmknnBuilder_html"><div class="ttname"><a href="https://knncolle.github.io/knncolle/classknncolle_1_1KmknnBuilder.html">knncolle::KmknnBuilder</a></div></div>
</div><!-- fragment --><p>We can also customize the construction of the <code>HnswBuilder</code> by passing in options:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>&amp; an_opts = an_builder.get_options();</div>
<div class="line">an_opts.num_links = 100;</div>
<div class="line">an_opts.distance_options.create = [](<span class="keywordtype">int</span> dim) -&gt; </div>
<div class="line"><a class="code hl_class" href="classknncolle__hnsw_1_1HnswPrebuilt.html">knncolle_hnsw::HnswBuilder&lt;&gt;</a> an_builder2(an_opts);</div>
</div><!-- fragment --><p>Check out the <a href="https://knncolle.github.io/knncolle_hnsw/">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
CMake with &lt;tt&gt;FetchContent&lt;/tt&gt;</h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  knncolle</div>
<div class="line">  GIT_REPOSITORY https://github.com/knncolle/knncolle_hnsw</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(knncolle_hnsw)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespaceknncolle__hnsw.html" title="knncolle bindings for HNSW search.">knncolle_hnsw</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe knncolle::knncolle_hnsw)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_hnsw)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
CMake with &lt;tt&gt;find_package()&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">find_package(knncolle_knncolle_hnsw CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE knncolle::knncolle_hnsw)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DKNNCOLLE_HNSW_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>By default, this will use <code>FetchContent</code> to fetch all external dependencies. If you want to install them manually, use <code>-DKNNCOLLE_HNSW_FETCH_EXTERN=OFF</code>. See <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> to find compatible versions of each dependency.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This requires the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a>, which also need to be made available during compilation.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Note on vectorization</h1>
<p>HNSW will attempt to perform manual vectorization based on SSE and/or AVX instructions. This may result in differences in the results across machines due to changes in numeric precision across architectures with varying support for SSE/AVX intrinsics. For the most part, such differences can be avoided by consistently compiling for the "near-lowest common denominator" (such as the typical <code>x86-64</code> default for GCC and Clang) and ensuring that the more specific instruction subsets like SSE3 and AVX are not enabled (which are typically off by default anyway). Nonetheless, if reproducibility across architectures is important, it can be achieved at the cost of some speed by defining the <code>NO_MANUAL_VECTORIZATION</code> macro, which will instruct Hnsw to disable its vectorized optimizations. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
